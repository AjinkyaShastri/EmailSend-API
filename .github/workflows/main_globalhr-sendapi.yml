name: Build and Deploy .NET Framework App to Azure WebApp

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: windows-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup NuGet
        uses: NuGet/setup-nuget@v2

      - name: Restore NuGet Packages
        run: nuget restore EmailSend-API.sln

      - name: Build with MSBuild
        run: msbuild EmailSend-API.sln /p:Configuration=Release

      - name: Archive files
        run: Compress-Archive -Path GlobaHr-SendEmail-API\bin\Release\* -DestinationPath WebApp.zip

      # ðŸ”¹ Login to Azure
      - name: Azure Login
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      # ðŸ”¹ Deploy to WebApp
      - name: Deploy to Azure WebApp
        uses: azure/webapps-deploy@v3
        with:
          app-name: "YOUR_AZURE_WEBAPP_NAME"
          package: WebApp.zip
